#!/usr/bin/env/python 
# -*- coding: utf-8 -*-
import csv
import cStringIO 
from random import shuffle

import networkx
from ffnet import ffnet, mlgraph

# Pardon my french :), Last column is 0 if you don't like, 1 if you like
CSV_FILE = """Aliment,"Calories (kcal)","joules (kJ)","Glucides (g)","Protides (g)","Lipides (g)","Sodium (mg)","Potassium (mg)","Magnésium (mg)","Calcium (mg)","Fer (mg)","Zinc (mg)","carotène(Provitamine A) mg","Vitamine B1 mg","Vitamine B2 mg","Vitamine B3 ou PP mg","Vitamine B6 mg","vitamine C mg","vitamine E mg","fibres g",Good
Abricot frais,50,209,11.2,0.8,0.2,2,278,62,16,0.4,0.2,298,0.04,0.05,0.7,0.3,10,0.7,2.1,1
Abricot sec,277,1158,63.4,4.6,0.4,26,1370,62,67,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Abricot sucré en conserve,88,368,21.0,0.6,0.1,2,250,7,9,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Airelle fraîche,25,104.5,5.0,0.2,0.4,3,320,20,56,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Airelle sucrée en conserve,126,527,30.0,0.3,0.5,3,180,5,12,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Amandefraîche,350,1463,15.0,13.0,26.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Amande sèche,620,2592,17.0,20.0,54.0,4,800,254,254,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Ananas frais,51,213,12.0,0.5,0.2,2,250,11,12,0.0,0.0,10,0,0.03,0.2,0.0,20,0.0,0.0,1
Ananas sucré en conserve,96,401,23.0,0.4,0.2,2,120,8,20,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Arachide grillée,636,2658,22.6,26.9,48.7,120,690,178,74,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Beurre d'Arachide,610,2549,18.0,28.0,47.0,120,790,178,55,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Avocat,167,698,4.7,2.1,16.4,4,680,45,10,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Banane fraîche,90,376,20.0,1.4,0.5,3,380,35,11,0.0,0.0,38,0.08,0.06,0.7,0.0,11,0.5,0.0,1
Banane séchée,292,1220,66.0,4.2,1.2,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Cacahuète(Arachide sèche),560,2341,26.0,23.0,40.0,120,740,180,12,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Cassis frais,65,251,16,1.3,0.4,2,325,24,55,1.6,0.0,23,0.05,0.05,0.3,0.08,189,0.0,0.0,1
Cerise douce,77,322,17.0,1.2,0.5,3,250,12,18,0.0,0.0,13,0.05,0.05,0.4,0.0,13,0.0,0.0,1
Cerise en conserve,53,222,12.0,0.2,0.6,3,180,10,12,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Cerise des Antilles,50,209,12.0,0.3,0.1,125,150,100,30,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Châtaignefraîche,207,865,42.8,3.7,2.3,4,470,41,11,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Châtaignesèche,371,1551,73.0,7.4,5.0,37,986,74,74,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Citron frais,40,167,7.8,0.8,0.6,6,160,12,11,0.0,0.0,3,0.05,0.02,0.2,0.0,52,0.0,0.0,1
Cocktail de fruits en conserve,78,326,18.2,0.4,0.3,5,160,8,9,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Coing,44,184,9.8,0.4,0.3,3,203,6,10,0.0,0.0,10,0.03,0.03,0.2,0.0,14,0.0,0.0,0
Cynorrhodon,116,485,25.0,4.0,4.0,5.0,165.0,15.0,75,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1500.0,0.0,0.0,0
Datte fraîche,165,699,37.0,2.0,1.0,5,350,63,34,0.0,0.0,1,0.05,0.06,0.8,0.2,33,0.0,0.0,0
Datte sèche,306,1279,73.0,2.2,0.6,1,650,63,71,3,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Figue fraîche,74,309,16.6,1.1,0.3,3,238,21,46,0.0,0.0,8,0.11,0.1,1,0.0,0.0,0.0,0.0,0
Figue sèche,305,1274,69.1,4.2,1.3,40,1010,70,126,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Fraise fraîche,36,150,7.0,0.7,0.5,12,160,3,17,0.0,0.0,13,0.03,0.06,0.6,0.04,62,0.0,0.0,1
Fraise sucrée en conserve,113,472,27.3,0.5,0.2,7,107,7,20,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Framboisefraîche,40,167,8.0,1.0,0.6,3,210,22,45,0.0,0.0,7,0.03,0.07,0.6,0.09,25,0.0,0.0,1
Framboisesucrée en conserve,95,397,22.5,0.6,0.3,2,100,13,18,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Goyave fraîche,76,318,17.0,0.7,0.6,4,390,20,15,0.0,0.0,0.3,0.05,0.04,1,0.0,240,0.0,0.0,0
Grenadefraîche,66,276,16.0,0.3,0.1,7,379,3,11,0.0,0.0,0.0,0.02,0.03,0,0,50.020,0.0,0.0,0
Groseilleblanche,45,188,9.8,1.3,0.1,2,290,9,22,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Groseille rouge,41,171,8.6,1.1,0.2,2,290,13,19,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Groseille à maquereau,30,125,5.0,1.0,0.5,3,213,7,15,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Kaki frais,42,176,9.0,0.7,0.4,3,210,7,15,0.0,0.0,0.9,0.02,0.02,0.3,0.0,90.015,0.0,0.0,0
Kiwi,42,176,9.0,0.7,0.4,3,210,7,15,0.0,0.0,0.0,0.02,0.05,0.4,0.0,100,0.0,0.0,1
Litchi frais,68,284,16.0,0.7,0.1,4,150,14,25,0.0,0.0,0.0,0.04,0.04,0.30,0.0,50,0.0,0.0,1
Mandarine,52,217,11.6,0.7,0.3,5,250,11,33,0.0,0.0,0.3,0.08,0.04,0.3,0.04,41,0.5,0.0,1
Mangue fraîche,64,267,15.0,0.4,0.2,0.0,175,17,17,0.0,0.0,0.5005,0.03,0.04,0.3,0.0,30,0.0,0.0,0
Purée deMarrons,199,832,38.0,0.9,2.6,7,40,0.0,31,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Melon,31,130,6.5,0.8,0.2,19,0.0,15,18,0.0,0.0,100,0.05,0.03,0.3,0.0,30,0.0,0.0,1
Mirabelle,45,188,10.0,0.7,0.2,2,230,15,12,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Mûre sauvage,37,155,6.2,0.9,0.9,3,190,25,18,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Mûre de culture,57,238,12.0,1.0,0.6,2,257,15,36,0.0,0.0,53,0.03,0.04,0.3,0.0,17,0.0,0.0,0
Myrtille,69,288,15.3,0.6,0.6,1,90,12,4,0.0,0.0,26,0.03,0.06,0.5,0.09,18,0.0,0.0,1
Nectarine,64,268,15.0,0.7,0.1,9,268,12,4,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Noisette,656,2743,15.0,14.0,60.0,3,600,150,200,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Noix,677,2830,14.3,15.0,62.2,2,544,129,82,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Noix du Brésil,676,2836,9.0,16.0,64.0,1.5,600,225,176,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Noix de cajou,612,2558,26.0,19.0,48.0,15,552,267,46,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Noix de cocofraîche,370,1546,10.0,4.0,35.0,20,370,35,21,0.0,0.0,0.0,0.05,0.02,0.6,0.0,2,0.0,0.0,1
Noix de cocosèche,630,2633,16.0,6.0,60.0,35,651,62,40,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Olive verte,207,865,6.0,0.8,20.0,128,1520,2,105,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Olive noire,156,652,3.5,1.6,15.0,132,1520,5,85,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Olive en saumure,123,514,5.0,12.5,11.0,2400,1526,22,61,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Orange,50,209,11.7,0.5,0.1,3,200,13,31,0.0,0.0,15,0.09,0.04,0.4,0.0,50,0.0,0.0,0
Pamplemousse,41,171,9.2,0.6,0.2,2,230,11,19,0.0,0.0,3,0.05,0.03,0.2,0.0,37,0.0,0.0,0
Papaye fraîche,44,184,10.0,0.2,0.6,3,211,40,31,0.0,0.0,10,0.05,0.1,1.5,0.0,20,0.0,0.0,0
Pastèque,25,104,5.3,0.4,0.2,4,158,8,5,0.0,0.0,1,0.05,0.03,36,0.5,35,0.0,0.0,0
Pêche,50,209,11.6,0.6,0.1,3,260,9,4,0.0,0.0,73,0.02,0.05,0.9,0.0,8,0.0,0.0,1
Pêche séchée,281,1175,65.5,3.3,0.6,16,1340,54,42,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Pignon de pin,670,2801,20.0,21.5,60.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Pistachefraîche,638,2667,15.2,4.0,54.5,5,972,58,131,7,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Poire,61,255,14.0,0.4,0.4,3,130,7,12,0.0,0.0,6,0.03,0.04,0.2,0.0,4,0.0,0.0,1
Poire sucrée en conserve,79,330,19.0,0.4,0.1,2,130,8,8,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Poire séchée,271,1133,62.0,1.8,1.8,13,585,31,40,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Pomme,52,217,12.0,0.3,0.3,2,120,5,6,0.0,0.0,8,0.03,0.03,0.2,0.0,0.4,0.0,0.0,1
Pomme en compote,83,397,19.8,0.3,0.2,0.3,55,5,4,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Pomme séchée,282,1178,65.0,1.4,1.9,10,576,24,24,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Prune,50,209,11.2,0.8,0.2,3,221,10,11,0.0,0.0,35,0.08,0.04,0.5,0.05,5,0.0,0.0,0
Prune sucrée en conserve,84,351,20.3,0.4,0.1,5,150,5,10,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Pruneau,290,1212,70.0,2.3,0.4,10,950,40,45,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Raisin frais,81,339,17.0,1.0,1.0,2,198,10,20,0.0,0.0,5,0.05,0.03,0.3,0.1,4,0.0,0.0,1
Raisin sec,311,1300,76.5,1.1,0.1,31,860,36,31,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1
Rhubarbe,19,79,3.8,0.6,0.1,5,300,16,51,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0
Tomate,15,0.0,2.8,0.8,0.1,5,0,11,9,0.5,140,0.6,0.06,0.04,0.6,0.08,18,1,1.0,1"""

TEST_SIZE = 10
def read_data():
    reader = csv.reader(cStringIO.StringIO(CSV_FILE))
    rows = [row for row in reader]
    header = rows[0]
    data = rows[1:]
    shuffle(data)
    return header, data[0:TEST_SIZE], data[TEST_SIZE:]

def main():
    header, tests, train = read_data()
    inputLength = len(header) - 2
    # Simple neural network
    conec = mlgraph( (inputLength,2,1) )
    net = ffnet(conec)
    train_input = [ u[1:-1] for u in train ]
    target_input  = [ u[-1] for u in train ]
    test_input = [ u[1:-1] for u in tests ]
    test_target  = [ u[-1] for u in tests ]
    net.train_tnc(train_input, target_input, maxfun = 1000)
    # Just to see if it is wrong, what the program guessed ...
    print [t[0] for t in tests]
    net.test(test_input, test_target, iprint = 2)

if __name__ == '__main__':
    main()
